import spidev
import time
 
# ???????????? SPI
spi = spidev.SpiDev()
spi.open(0, 0)  # SPI0, CE0 (GPIO 8, Pin 24)
spi.max_speed_hz = 1000000  # 1 MHz
 
def read_adc(channel):
    if channel < 0 or channel > 7:
        return -1
    # SPI ?????? ??? ???????? ????????
    adc = spi.xfer2([1, (8 + channel) << 4, 0])
    data = ((adc[1] & 3) << 8) + adc[2]
    return data
 
try:
    print("???????? ??? MCP3008 (CH0)... ??????? Ctrl+C ??? ??????????.")
    while True:
        # ??????? ?? ?????? 0
        adc_value = read_adc(0)
        # ????????? ?? ???? (3.3V / 1023 ??? 10-bit ADC)
        voltage = adc_value * 3.3 / 1023
        print(f"MCP3008 ADC Value (CH0): {adc_value}, Voltage: {voltage:.3f}V")
        time.sleep(0.5)  # ????????? 0.5 ????????????? ??? ?????????
except KeyboardInterrupt:
    print("???????????...")
    spi.close()
